{% extends "base.html" %} {% block content %}
<h2 class="display-5 fw-bold mb-4" style="color: var(--purple-dark)">
  Gerir Cardápio ({{ current_user.restaurante.nome_fantasia }})
</h2>

<div class="row">
  <div class="col-md-8">
    <h3 class="h4 mb-3" style="color: var(--purple-light)">
      Categorias e Produtos Salvos
    </h3>

    {% if not categorias %}
    <div class="alert alert-info">
      Adicione uma categoria no painel ao lado para começar.
    </div>
    {% else %} {% for categoria in categorias %}
    <div
      class="card mb-4 shadow-sm"
      style="border-top: 5px solid var(--purple-dark)"
    >
      <div
        class="card-header d-flex justify-content-between align-items-center bg-light"
      >
        <h5 class="mb-0 fw-bold">
          {{ categoria.nome }} ({{ categoria.produtos | length }})
        </h5>

        <form
          method="POST"
          action="{{ url_for('restaurant.delete_category', categoria_id=categoria.id) }}"
          style="display: inline"
        >
          <button
            type="submit"
            class="btn btn-sm btn-outline-danger"
            onclick="return confirm('ATENÇÃO: Apagar esta categoria também apagará TODOS os produtos dentro dela. Tem a certeza?')"
          >
            <i class="fas fa-times"></i> Apagar
          </button>
        </form>
      </div>

      <ul class="list-group list-group-flush">
        {% if not categoria.produtos %}
        <li class="list-group-item text-muted">
          Nenhum produto nesta categoria.
        </li>
        {% else %} {% for produto in categoria.produtos %}
        <li
          class="list-group-item d-flex justify-content-between align-items-start"
        >
          <div>
            <div class="fw-bold">
              {{ produto.nome }} - R$ {{ "%.2f"|format(produto.preco) }}
            </div>
            <div class="text-muted small">{{ produto.descricao }}</div>
          </div>
          <span
            class="badge rounded-pill {% if produto.disponivel %}bg-success{% else %}bg-warning{% endif %}"
          >
            {{ "Disponível" if produto.disponivel else "Indisponível" }}
          </span>

          <form
            method="POST"
            action="{{ url_for('restaurant.delete_product', produto_id=produto.id) }}"
            style="display: inline"
            class="ms-3"
          >
            <button
              type="submit"
              class="btn btn-sm btn-outline-secondary"
              onclick="return confirm('Apagar {{ produto.nome }}?')"
            >
              <i class="fas fa-trash-alt"></i>
            </button>
          </form>
        </li>
        {% endfor %} {% endif %}
      </ul>
    </div>
    {% endfor %} {% endif %}
  </div>

  <div class="col-md-4">
    <aside
      class="p-3 shadow-lg rounded"
      style="background-color: var(--purple-bg) !important"
    >
      <h3 class="h5 fw-bold mb-3" style="color: var(--purple-dark)">
        Adicionar Categoria
      </h3>
      <form method="POST" action="{{ url_for('restaurant.manage_menu') }}">
        {{ category_form.hidden_tag() }}
        <div class="mb-3">
          <label class="form-label">{{ category_form.nome.label }}</label>
          {{ category_form.nome(class="form-control") }}
        </div>
        <div class="d-grid mb-4">
          {{ category_form.submit_category(class="btn btn-purple",
          style="background-color: var(--purple-light);") }}
        </div>
      </form>

      <hr />

      {% if categorias %}
      <h3 class="h5 fw-bold mb-3" style="color: var(--purple-dark)">
        Adicionar Produto
      </h3>
      <form method="POST" action="{{ url_for('restaurant.manage_menu') }}">
        {{ product_form.hidden_tag() }}

        <div class="mb-3">
          <label class="form-label"
            >{{ product_form.categoria_id.label }}</label
          >
          {{ product_form.categoria_id(class="form-select") }}
        </div>

        <div class="mb-3">
          <label class="form-label">{{ product_form.nome.label }}</label>
          {{ product_form.nome(class="form-control") }}
        </div>
        <div class="mb-3">
          <label class="form-label">{{ product_form.descricao.label }}</label>
          {{ product_form.descricao(class="form-control", rows=3) }}
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label">{{ product_form.preco.label }}</label>
            {{ product_form.preco(class="form-control", type="number",
            step="0.01") }}
          </div>
          <div class="col-6 mb-3 d-flex align-items-end">
            <div class="form-check">
              {{ product_form.disponivel(class="form-check-input") }} {{
              product_form.disponivel.label(class="form-check-label") }}
            </div>
          </div>
        </div>

        <div class="d-grid">
          {{ product_form.submit_product(class="btn btn-purple",
          style="background-color: var(--purple-dark);") }}
        </div>
      </form>
      {% else %}
      <div class="alert alert-warning">
        Adicione uma categoria para ver o formulário de produto.
      </div>
      {% endif %}
    </aside>
  </div>
</div>

{% endblock content %}
