{% extends "base.html" %} {% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <h2 class="display-5 fw-bold mb-4" style="color: var(--purple-dark)">
      Finalizar Pedido
    </h2>

    {% if not itens_carrinho %}
    <div class="alert alert-info">O seu carrinho está vazio.</div>
    <a href="{{ url_for('auth.home') }}">Ver restaurantes</a>
    {% else %}

    <div class="card mb-4 shadow-sm">
      <div
        class="card-header bg-purple text-white d-flex align-items-center"
        style="background-color: var(--purple-dark) !important"
      >
        {% if restaurante.logo_url %}
        <img
          src="{{ restaurante.logo_url }}"
          class="rounded-circle me-2 border border-white"
          style="width: 30px; height: 30px; object-fit: cover"
        />
        {% endif %}
        <h5 class="mb-0">
          1. Resumo do Pedido (Restaurante: {{ restaurante.nome_fantasia }})
        </h5>
      </div>

      <div class="card-body">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Produto</th>
              <th class="text-end">Preço Unit.</th>
              <th class="text-center">Quantidade</th>
              <th class="text-end">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for item in itens_carrinho %}
            <tr>
              <td>{{ item.nome }}</td>
              <td class="text-end">R$ {{ "%.2f"|format(item.preco) }}</td>
              <td class="text-center">{{ item.quantidade }}</td>
              <td class="text-end">R$ {{ "%.2f"|format(item.subtotal) }}</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="fw-bold">
              <td colspan="3" class="text-end">Subtotal dos Produtos:</td>
              <td class="text-end">R$ {{ "%.2f"|format(total_produtos) }}</td>
            </tr>
            <tr class="fw-bold">
              <td colspan="3" class="text-end">Taxa de Entrega:</td>
              <td class="text-end">R$ {{ "%.2f"|format(taxa_entrega) }}</td>
            </tr>
            <tr class="table-info fw-bold fs-5">
              <td colspan="3" class="text-end">Total a Pagar:</td>
              <td class="text-end">R$ {{ "%.2f"|format(total_final) }}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="card mb-4 shadow-sm">
      <div
        class="card-header bg-purple text-white"
        style="background-color: var(--purple-light) !important"
      >
        <h5 class="mb-0">2. Endereço e Pagamento</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="">
          {{ form.hidden_tag() }} {% if not form.endereco_id.choices %}
          <div class="alert alert-danger">
            Você não tem endereços registados!
            <a
              href="{{ url_for('client.manage_addresses') }}"
              class="alert-link"
              >Clique aqui para adicionar.</a
            >
          </div>
          {% else %}
          <div class="mb-3">
            <label class="form-label fw-bold"
              >{{ form.endereco_id.label }}</label
            >
            {% for subfield in form.endereco_id %}
            <div class="form-check">
              {{ subfield(class="form-check-input") }} {{
              subfield.label(class="form-check-label") }}
            </div>
            {% endfor %}
          </div>

          <div class="d-grid mt-4">
            {{ form.submit(class="btn btn-purple btn-lg fw-bold",
            style="background-color: var(--purple-dark);") }}
          </div>
          {% endif %}
        </form>
      </div>
    </div>

    <p class="text-center">
      <a href="{{ url_for('auth.view_cart') }}">← Voltar ao Carrinho</a>
    </p>

    {% endif %}
  </div>
</div>
{% endblock content %}
